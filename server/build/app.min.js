var mmommo=function(e){var t={};var i={};function s(i){if(t[i]){return t[i].exports}var r=t[i]={i,l:false,exports:{}};e[i].call(r.exports,r,r.exports,s);r.l=true;return r.exports}s.m=e;s.c=t;s.d=function(e,t,i){if(!s.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:i})}};s.r=function(e){Object.defineProperty(e,"__esModule",{value:true})};s.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};s.d(t,"a",t);return t};s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};s.p="";s.w={};return s(s.s=13)}([function(e,t){e.exports=require("util")},function(e,t){e.exports=require("events")},function(e,t,i){var s=t.noop=function(){};t.extend=function e(t,i){for(var s in i){t[s]=i[s]}};t.eventEmitterListenerCount=i(1).EventEmitter.listenerCount||function(e,t){return e.listeners(t).length};t.BufferingLogger=function e(t,n){var o=i(11)(t);if(o.enabled){var a=new r(t,n,o);var c=a.log.bind(a);c.printOutput=a.printOutput.bind(a);c.enabled=o.enabled;return c}o.printOutput=s;return o};function r(e,t,i){this.logFunction=i;this.identifier=e;this.uniqueID=t;this.buffer=[]}r.prototype.log=function(){this.buffer.push([new Date,Array.prototype.slice.call(arguments)]);return this};r.prototype.clear=function(){this.buffer=[];return this};r.prototype.printOutput=function(e){if(!e){e=this.logFunction}var t=this.uniqueID;this.buffer.forEach(function(i){var s=i[0].toLocaleString();var r=i[1].slice();var n=r[0];if(n!==void 0&&n!==null){n="%s - %s - "+n.toString();r.splice(0,1,n,s,t);e.apply(global,r)}})}},function(e,t){e.exports=require("crypto")},function(e,t,i){var s=i(0);var r=i(2);var n=i(1).EventEmitter;var o=i(7);var a=i(29);var c=i(27).Validation;const h="open";const u="peer_requested_close";const l="ending";const f="closed";var d="setImmediate"in global?global.setImmediate.bind(global):process.nextTick.bind(process);var p=0;function g(e,t,i,s,c){this._debug=r.BufferingLogger("websocket:connection",++p);this._debug("constructor");if(this._debug.enabled){v(this,e)}n.call(this);this._pingListenerCount=0;this.on("newListener",function(e){if(e==="ping"){this._pingListenerCount++}}).on("removeListener",function(e){if(e==="ping"){this._pingListenerCount--}});this.config=c;this.socket=e;this.protocol=i;this.extensions=t;this.remoteAddress=e.remoteAddress;this.closeReasonCode=-1;this.closeDescription=null;this.closeEventEmitted=false;this.maskOutgoingPackets=s;this.maskBytes=new Buffer(4);this.frameHeader=new Buffer(10);this.bufferList=new a;this.currentFrame=new o(this.maskBytes,this.frameHeader,this.config);this.fragmentationSize=0;this.frameQueue=[];this.connected=true;this.state=h;this.waitingForCloseResponse=false;this.receivedEnd=false;this.closeTimeout=this.config.closeTimeout;this.assembleFragments=this.config.assembleFragments;this.maxReceivedMessageSize=this.config.maxReceivedMessageSize;this.outputBufferFull=false;this.inputPaused=false;this.receivedDataHandler=this.processReceivedData.bind(this);this._closeTimerHandler=this.handleCloseTimer.bind(this);this.socket.setNoDelay(this.config.disableNagleAlgorithm);this.socket.setTimeout(0);if(this.config.keepalive&&!this.config.useNativeKeepalive){if(typeof this.config.keepaliveInterval!=="number"){throw new Error("keepaliveInterval must be specified and numeric "+"if keepalive is true.")}this._keepaliveTimerHandler=this.handleKeepaliveTimer.bind(this);this.setKeepaliveTimer();if(this.config.dropConnectionOnKeepaliveTimeout){if(typeof this.config.keepaliveGracePeriod!=="number"){throw new Error("keepaliveGracePeriod  must be specified and "+"numeric if dropConnectionOnKeepaliveTimeout "+"is true.")}this._gracePeriodTimerHandler=this.handleGracePeriodTimer.bind(this)}}else if(this.config.keepalive&&this.config.useNativeKeepalive){if(!("setKeepAlive"in this.socket)){throw new Error("Unable to use native keepalive: unsupported by "+"this version of Node.")}this.socket.setKeepAlive(true,this.config.keepaliveInterval)}this.socket.removeAllListeners("error")}g.CLOSE_REASON_NORMAL=1e3;g.CLOSE_REASON_GOING_AWAY=1001;g.CLOSE_REASON_PROTOCOL_ERROR=1002;g.CLOSE_REASON_UNPROCESSABLE_INPUT=1003;g.CLOSE_REASON_RESERVED=1004;g.CLOSE_REASON_NOT_PROVIDED=1005;g.CLOSE_REASON_ABNORMAL=1006;g.CLOSE_REASON_INVALID_DATA=1007;g.CLOSE_REASON_POLICY_VIOLATION=1008;g.CLOSE_REASON_MESSAGE_TOO_BIG=1009;g.CLOSE_REASON_EXTENSION_REQUIRED=1010;g.CLOSE_REASON_INTERNAL_SERVER_ERROR=1011;g.CLOSE_REASON_TLS_HANDSHAKE_FAILED=1015;g.CLOSE_DESCRIPTIONS={1000:"Normal connection closure",1001:"Remote peer is going away",1002:"Protocol error",1003:"Unprocessable input",1004:"Reserved",1005:"Reason not provided",1006:"Abnormal closure, no further detail available",1007:"Invalid data received",1008:"Policy violation",1009:"Message too big",1010:"Extension requested by client is required",1011:"Internal Server Error",1015:"TLS Handshake Failed"};function m(e){if(e<1e3){return false}if(e>=1e3&&e<=2999){return[1e3,1001,1002,1003,1007,1008,1009,1010,1011,1012,1013,1014].indexOf(e)!==-1}if(e>=3e3&&e<=3999){return true}if(e>=4e3&&e<=4999){return true}if(e>=5e3){return false}}s.inherits(g,n);g.prototype._addSocketEventListeners=function(){this.socket.on("error",this.handleSocketError.bind(this));this.socket.on("end",this.handleSocketEnd.bind(this));this.socket.on("close",this.handleSocketClose.bind(this));this.socket.on("drain",this.handleSocketDrain.bind(this));this.socket.on("pause",this.handleSocketPause.bind(this));this.socket.on("resume",this.handleSocketResume.bind(this));this.socket.on("data",this.handleSocketData.bind(this))};g.prototype.setKeepaliveTimer=function(){this._debug("setKeepaliveTimer");if(!this.config.keepalive||this.config.useNativeKeepalive){return}this.clearKeepaliveTimer();this.clearGracePeriodTimer();this._keepaliveTimeoutID=setTimeout(this._keepaliveTimerHandler,this.config.keepaliveInterval)};g.prototype.clearKeepaliveTimer=function(){if(this._keepaliveTimeoutID){clearTimeout(this._keepaliveTimeoutID)}};g.prototype.handleKeepaliveTimer=function(){this._debug("handleKeepaliveTimer");this._keepaliveTimeoutID=null;this.ping();if(this.config.dropConnectionOnKeepaliveTimeout){this.setGracePeriodTimer()}else{this.setKeepaliveTimer()}};g.prototype.setGracePeriodTimer=function(){this._debug("setGracePeriodTimer");this.clearGracePeriodTimer();this._gracePeriodTimeoutID=setTimeout(this._gracePeriodTimerHandler,this.config.keepaliveGracePeriod)};g.prototype.clearGracePeriodTimer=function(){if(this._gracePeriodTimeoutID){clearTimeout(this._gracePeriodTimeoutID)}};g.prototype.handleGracePeriodTimer=function(){this._debug("handleGracePeriodTimer");this._gracePeriodTimeoutID=null;this.drop(g.CLOSE_REASON_ABNORMAL,"Peer not responding.",true)};g.prototype.handleSocketData=function(e){this._debug("handleSocketData");this.setKeepaliveTimer();this.bufferList.write(e);this.processReceivedData()};g.prototype.processReceivedData=function(){this._debug("processReceivedData");if(!this.connected){return}if(this.inputPaused){return}var e=this.currentFrame;if(!e.addData(this.bufferList)){this._debug("-- insufficient data for frame");return}var t=this;if(e.protocolError){this._debug("-- protocol error");process.nextTick(function(){t.drop(g.CLOSE_REASON_PROTOCOL_ERROR,e.dropReason)});return}else if(e.frameTooLarge){this._debug("-- frame too large");process.nextTick(function(){t.drop(g.CLOSE_REASON_MESSAGE_TOO_BIG,e.dropReason)});return}if(e.rsv1||e.rsv2||e.rsv3){this._debug("-- illegal rsv flag");process.nextTick(function(){t.drop(g.CLOSE_REASON_PROTOCOL_ERROR,"Unsupported usage of rsv bits without negotiated extension.")});return}if(!this.assembleFragments){this._debug("-- emitting frame");process.nextTick(function(){t.emit("frame",e)})}process.nextTick(function(){t.processFrame(e)});this.currentFrame=new o(this.maskBytes,this.frameHeader,this.config);if(this.bufferList.length>0){d(this.receivedDataHandler)}};g.prototype.handleSocketError=function(e){this._debug("handleSocketError: %j",e);if(this.state===f){this._debug("  --- Socket 'error' after 'close'");return}this.closeReasonCode=g.CLOSE_REASON_ABNORMAL;this.closeDescription="Socket Error: "+e.syscall+" "+e.code;this.connected=false;this.state=f;this.fragmentationSize=0;if(r.eventEmitterListenerCount(this,"error")>0){this.emit("error",e)}this.socket.destroy(e);this._debug.printOutput()};g.prototype.handleSocketEnd=function(){this._debug("handleSocketEnd: received socket end.  state = %s",this.state);this.receivedEnd=true;if(this.state===f){this._debug("  --- Socket 'end' after 'close'");return}if(this.state!==u&&this.state!==l){this._debug("  --- UNEXPECTED socket end.");this.socket.end()}};g.prototype.handleSocketClose=function(e){this._debug("handleSocketClose: received socket close");this.socketHadError=e;this.connected=false;this.state=f;if(this.closeReasonCode===-1){this.closeReasonCode=g.CLOSE_REASON_ABNORMAL;this.closeDescription="Connection dropped by remote peer."}this.clearCloseTimer();this.clearKeepaliveTimer();this.clearGracePeriodTimer();if(!this.closeEventEmitted){this.closeEventEmitted=true;this._debug("-- Emitting WebSocketConnection close event");this.emit("close",this.closeReasonCode,this.closeDescription)}};g.prototype.handleSocketDrain=function(){this._debug("handleSocketDrain: socket drain event");this.outputBufferFull=false;this.emit("drain")};g.prototype.handleSocketPause=function(){this._debug("handleSocketPause: socket pause event");this.inputPaused=true;this.emit("pause")};g.prototype.handleSocketResume=function(){this._debug("handleSocketResume: socket resume event");this.inputPaused=false;this.emit("resume");this.processReceivedData()};g.prototype.pause=function(){this._debug("pause: pause requested");this.socket.pause()};g.prototype.resume=function(){this._debug("resume: resume requested");this.socket.resume()};g.prototype.close=function(e,t){if(this.connected){this._debug("close: Initating clean WebSocket close sequence.");if("number"!==typeof e){e=g.CLOSE_REASON_NORMAL}if(!m(e)){throw new Error("Close code "+e+" is not valid.")}if("string"!==typeof t){t=g.CLOSE_DESCRIPTIONS[e]}this.closeReasonCode=e;this.closeDescription=t;this.setCloseTimer();this.sendCloseFrame(this.closeReasonCode,this.closeDescription);this.state=l;this.connected=false}};g.prototype.drop=function(e,t,i){this._debug("drop");if(typeof e!=="number"){e=g.CLOSE_REASON_PROTOCOL_ERROR}if(typeof t!=="string"){t=g.CLOSE_DESCRIPTIONS[e]}this._debug("Forcefully dropping connection. skipCloseFrame: %s, code: %d, description: %s",i,e,t);this.closeReasonCode=e;this.closeDescription=t;this.frameQueue=[];this.fragmentationSize=0;if(!i){this.sendCloseFrame(e,t)}this.connected=false;this.state=f;this.clearCloseTimer();this.clearKeepaliveTimer();this.clearGracePeriodTimer();if(!this.closeEventEmitted){this.closeEventEmitted=true;this._debug("Emitting WebSocketConnection close event");this.emit("close",this.closeReasonCode,this.closeDescription)}this._debug("Drop: destroying socket");this.socket.destroy()};g.prototype.setCloseTimer=function(){this._debug("setCloseTimer");this.clearCloseTimer();this._debug("Setting close timer");this.waitingForCloseResponse=true;this.closeTimer=setTimeout(this._closeTimerHandler,this.closeTimeout)};g.prototype.clearCloseTimer=function(){this._debug("clearCloseTimer");if(this.closeTimer){this._debug("Clearing close timer");clearTimeout(this.closeTimer);this.waitingForCloseResponse=false;this.closeTimer=null}};g.prototype.handleCloseTimer=function(){this._debug("handleCloseTimer");this.closeTimer=null;if(this.waitingForCloseResponse){this._debug("Close response not received from client.  Forcing socket end.");this.waitingForCloseResponse=false;this.state=f;this.socket.end()}};g.prototype.processFrame=function(e){this._debug("processFrame");this._debug(" -- frame: %s",e);if(this.frameQueue.length!==0&&(e.opcode>0&&e.opcode<8)){this.drop(g.CLOSE_REASON_PROTOCOL_ERROR,"Illegal frame opcode 0x"+e.opcode.toString(16)+" "+"received in middle of fragmented message.");return}switch(e.opcode){case 2:this._debug("-- Binary Frame");if(this.assembleFragments){if(e.fin){this._debug("---- Emitting 'message' event");this.emit("message",{type:"binary",binaryData:e.binaryPayload})}else{this.frameQueue.push(e);this.fragmentationSize=e.length}}break;case 1:this._debug("-- Text Frame");if(this.assembleFragments){if(e.fin){if(!c.isValidUTF8(e.binaryPayload)){this.drop(g.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");return}this._debug("---- Emitting 'message' event");this.emit("message",{type:"utf8",utf8Data:e.binaryPayload.toString("utf8")})}else{this.frameQueue.push(e);this.fragmentationSize=e.length}}break;case 0:this._debug("-- Continuation Frame");if(this.assembleFragments){if(this.frameQueue.length===0){this.drop(g.CLOSE_REASON_PROTOCOL_ERROR,"Unexpected Continuation Frame");return}this.fragmentationSize+=e.length;if(this.fragmentationSize>this.maxReceivedMessageSize){this.drop(g.CLOSE_REASON_MESSAGE_TOO_BIG,"Maximum message size exceeded.");return}this.frameQueue.push(e);if(e.fin){var t=0;var i=new Buffer(this.fragmentationSize);var s=this.frameQueue[0].opcode;this.frameQueue.forEach(function(e){e.binaryPayload.copy(i,t);t+=e.binaryPayload.length});this.frameQueue=[];this.fragmentationSize=0;switch(s){case 2:this.emit("message",{type:"binary",binaryData:i});break;case 1:if(!c.isValidUTF8(i)){this.drop(g.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");return}this.emit("message",{type:"utf8",utf8Data:i.toString("utf8")});break;default:this.drop(g.CLOSE_REASON_PROTOCOL_ERROR,"Unexpected first opcode in fragmentation sequence: 0x"+s.toString(16));return}}}break;case 9:this._debug("-- Ping Frame");if(this._pingListenerCount>0){var r=false;var n=function(){r=true};this.emit("ping",n,e.binaryPayload);if(!r){this.pong(e.binaryPayload)}}else{this.pong(e.binaryPayload)}break;case 10:this._debug("-- Pong Frame");this.emit("pong",e.binaryPayload);break;case 8:this._debug("-- Close Frame");if(this.waitingForCloseResponse){this._debug("---- Got close response from peer.  Completing closing handshake.");this.clearCloseTimer();this.waitingForCloseResponse=false;this.state=f;this.socket.end();return}this._debug("---- Closing handshake initiated by peer.");this.state=u;var o;if(e.invalidCloseFrameLength){this.closeReasonCode=1005;o=g.CLOSE_REASON_PROTOCOL_ERROR}else if(e.closeStatus===-1||m(e.closeStatus)){this.closeReasonCode=e.closeStatus;o=g.CLOSE_REASON_NORMAL}else{this.closeReasonCode=e.closeStatus;o=g.CLOSE_REASON_PROTOCOL_ERROR}if(e.binaryPayload.length>1){if(!c.isValidUTF8(e.binaryPayload)){this.drop(g.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");return}this.closeDescription=e.binaryPayload.toString("utf8")}else{this.closeDescription=g.CLOSE_DESCRIPTIONS[this.closeReasonCode]}this._debug("------ Remote peer %s - code: %d - %s - close frame payload length: %d",this.remoteAddress,this.closeReasonCode,this.closeDescription,e.length);this._debug("------ responding to remote peer's close request.");this.sendCloseFrame(o,null);this.connected=false;break;default:this._debug("-- Unrecognized Opcode %d",e.opcode);this.drop(g.CLOSE_REASON_PROTOCOL_ERROR,"Unrecognized Opcode: 0x"+e.opcode.toString(16));break}};g.prototype.send=function(e,t){this._debug("send");if(Buffer.isBuffer(e)){this.sendBytes(e,t)}else if(typeof e["toString"]==="function"){this.sendUTF(e,t)}else{throw new Error("Data provided must either be a Node Buffer or implement toString()")}};g.prototype.sendUTF=function(e,t){e=new Buffer(e.toString(),"utf8");this._debug("sendUTF: %d bytes",e.length);var i=new o(this.maskBytes,this.frameHeader,this.config);i.opcode=1;i.binaryPayload=e;this.fragmentAndSend(i,t)};g.prototype.sendBytes=function(e,t){this._debug("sendBytes");if(!Buffer.isBuffer(e)){throw new Error("You must pass a Node Buffer object to WebSocketConnection.prototype.sendBytes()")}var i=new o(this.maskBytes,this.frameHeader,this.config);i.opcode=2;i.binaryPayload=e;this.fragmentAndSend(i,t)};g.prototype.ping=function(e){this._debug("ping");var t=new o(this.maskBytes,this.frameHeader,this.config);t.opcode=9;t.fin=true;if(e){if(!Buffer.isBuffer(e)){e=new Buffer(e.toString(),"utf8")}if(e.length>125){this._debug("WebSocket: Data for ping is longer than 125 bytes.  Truncating.");e=e.slice(0,124)}t.binaryPayload=e}this.sendFrame(t)};g.prototype.pong=function(e){this._debug("pong");var t=new o(this.maskBytes,this.frameHeader,this.config);t.opcode=10;if(Buffer.isBuffer(e)&&e.length>125){this._debug("WebSocket: Data for pong is longer than 125 bytes.  Truncating.");e=e.slice(0,124)}t.binaryPayload=e;t.fin=true;this.sendFrame(t)};g.prototype.fragmentAndSend=function(e,t){this._debug("fragmentAndSend");if(e.opcode>7){throw new Error("You cannot fragment control frames.")}var i=this.config.fragmentationThreshold;var s=e.binaryPayload.length;if(!this.config.fragmentOutgoingMessages||e.binaryPayload&&s<=i){e.fin=true;this.sendFrame(e,t);return}var r=Math.ceil(s/i);var n=0;var a=function e(i){if(i){if(typeof t==="function"){t(i);t=null}return}++n;if(n===r&&typeof t==="function"){t()}};for(var c=1;c<=r;c++){var h=new o(this.maskBytes,this.frameHeader,this.config);h.opcode=c===1?e.opcode:0;h.fin=c===r;var u=c===r?s-i*(c-1):i;var l=i*(c-1);h.binaryPayload=e.binaryPayload.slice(l,l+u);this.sendFrame(h,a)}};g.prototype.sendCloseFrame=function(e,t,i){if(typeof e!=="number"){e=g.CLOSE_REASON_NORMAL}this._debug("sendCloseFrame state: %s, reasonCode: %d, description: %s",this.state,e,t);if(this.state!==h&&this.state!==u){return}var s=new o(this.maskBytes,this.frameHeader,this.config);s.fin=true;s.opcode=8;s.closeStatus=e;if(typeof t==="string"){s.binaryPayload=new Buffer(t,"utf8")}this.sendFrame(s,i);this.socket.end()};g.prototype.sendFrame=function(e,t){this._debug("sendFrame");e.mask=this.maskOutgoingPackets;var i=this.socket.write(e.toBuffer(),t);this.outputBufferFull=!i;return i};e.exports=g;function v(e,t){if(!e._debug.enabled){return}var i=t.emit;t.emit=function(t){e._debug("||| Socket Event  '%s'",t);i.apply(this,arguments)};for(var s in t){if("function"!==typeof t[s]){continue}if(["emit"].indexOf(s)!==-1){continue}(function(i){var s=t[i];if(i==="on"){t[i]=function t(){e._debug("||| Socket method called:  %s (%s)",i,arguments[0]);return s.apply(this,arguments)};return}t[i]=function t(){e._debug("||| Socket method called:  %s",i);return s.apply(this,arguments)}})(s)}}},function(e,t){e.exports=require("http")},function(e,t,i){var s=i(2);var r=s.extend;var n=i(0);var o=i(1).EventEmitter;var a=i(5);var c=i(25);var h=i(8);var u=i(3);var l=i(4);var f=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," ",String.fromCharCode(9)];function d(e){o.call(this);this.config={maxReceivedFrameSize:1048576,maxReceivedMessageSize:8388608,fragmentOutgoingMessages:true,fragmentationThreshold:16384,webSocketVersion:13,assembleFragments:true,disableNagleAlgorithm:true,closeTimeout:5e3,tlsOptions:{}};if(e){var t;if(e.tlsOptions){t=e.tlsOptions;delete e.tlsOptions}else{t={}}r(this.config,e);r(this.config.tlsOptions,t)}this._req=null;switch(this.config.webSocketVersion){case 8:case 13:break;default:throw new Error("Requested webSocketVersion is not supported. Allowed values are 8 and 13.")}}n.inherits(d,o);d.prototype.connect=function(e,t,i,n,o){var u=this;if(typeof t==="string"){if(t.length>0){t=[t]}else{t=[]}}if(!(t instanceof Array)){t=[]}this.protocols=t;this.origin=i;if(typeof e==="string"){this.url=h.parse(e)}else{this.url=e}if(!this.url.protocol){throw new Error("You must specify a full WebSocket URL, including protocol.")}if(!this.url.host){throw new Error("You must specify a full WebSocket URL, including hostname. Relative URLs are not supported.")}this.secure=this.url.protocol==="wss:";this.protocols.forEach(function(e){for(var t=0;t<e.length;t++){var i=e.charCodeAt(t);var s=e.charAt(t);if(i<33||i>126||f.indexOf(s)!==-1){throw new Error('Protocol list contains invalid character "'+String.fromCharCode(i)+'"')}}});var l={"ws:":"80","wss:":"443"};if(!this.url.port){this.url.port=l[this.url.protocol]}var d=new Buffer(16);for(var p=0;p<16;p++){d[p]=Math.round(Math.random()*255)}this.base64nonce=d.toString("base64");var g=this.url.hostname;if(this.url.protocol==="ws:"&&this.url.port!=="80"||this.url.protocol==="wss:"&&this.url.port!=="443"){g+=":"+this.url.port}var m=n||{};r(m,{Upgrade:"websocket",Connection:"Upgrade","Sec-WebSocket-Version":this.config.webSocketVersion.toString(10),"Sec-WebSocket-Key":this.base64nonce,Host:m.Host||g});if(this.protocols.length>0){m["Sec-WebSocket-Protocol"]=this.protocols.join(", ")}if(this.origin){if(this.config.webSocketVersion===13){m["Origin"]=this.origin}else if(this.config.webSocketVersion===8){m["Sec-WebSocket-Origin"]=this.origin}}var v;if(this.url.pathname){v=this.url.path}else if(this.url.path){v="/"+this.url.path}else{v="/"}function b(e){u._req=null;u.emit("connectFailed",e)}var y={agent:false};if(o){r(y,o)}r(y,{hostname:this.url.hostname,port:this.url.port,method:"GET",path:v,headers:m});if(this.secure){for(var E in u.config.tlsOptions){if(u.config.tlsOptions.hasOwnProperty(E)){y[E]=u.config.tlsOptions[E]}}}var S=this._req=(this.secure?c:a).request(y);S.on("upgrade",function e(t,i,s){u._req=null;S.removeListener("error",b);u.socket=i;u.response=t;u.firstDataChunk=s;u.validateHandshake()});S.on("error",b);S.on("response",function(e){u._req=null;if(s.eventEmitterListenerCount(u,"httpResponse")>0){u.emit("httpResponse",e,u);if(e.socket){e.socket.end()}}else{var t=[];for(var i in e.headers){t.push(i+": "+e.headers[i])}u.failHandshake("Server responded with a non-101 status: "+e.statusCode+" "+e.statusMessage+"\nResponse Headers Follow:\n"+t.join("\n")+"\n")}});S.end()};d.prototype.validateHandshake=function(){var e=this.response.headers;if(this.protocols.length>0){this.protocol=e["sec-websocket-protocol"];if(this.protocol){if(this.protocols.indexOf(this.protocol)===-1){this.failHandshake("Server did not respond with a requested protocol.");return}}else{this.failHandshake("Expected a Sec-WebSocket-Protocol header.");return}}if(!(e["connection"]&&e["connection"].toLocaleLowerCase()==="upgrade")){this.failHandshake("Expected a Connection: Upgrade header from the server");return}if(!(e["upgrade"]&&e["upgrade"].toLocaleLowerCase()==="websocket")){this.failHandshake("Expected an Upgrade: websocket header from the server");return}var t=u.createHash("sha1");t.update(this.base64nonce+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var i=t.digest("base64");if(!e["sec-websocket-accept"]){this.failHandshake("Expected Sec-WebSocket-Accept header from server");return}if(e["sec-websocket-accept"]!==i){this.failHandshake("Sec-WebSocket-Accept header from server didn't match expected value of "+i);return}this.succeedHandshake()};d.prototype.failHandshake=function(e){if(this.socket&&this.socket.writable){this.socket.end()}this.emit("connectFailed",new Error(e))};d.prototype.succeedHandshake=function(){var e=new l(this.socket,[],this.protocol,true,this.config);e.webSocketVersion=this.config.webSocketVersion;e._addSocketEventListeners();this.emit("connect",e);if(this.firstDataChunk.length>0){e.handleSocketData(this.firstDataChunk)}this.firstDataChunk=null};d.prototype.abort=function(){if(this._req){this._req.abort()}};e.exports=d},function(e,t,i){var s=i(31).BufferUtil;const r=1;const n=2;const o=3;const a=4;const c=5;const h=6;function u(e,t,i){this.maskBytes=e;this.frameHeader=t;this.config=i;this.maxReceivedFrameSize=i.maxReceivedFrameSize;this.protocolError=false;this.frameTooLarge=false;this.invalidCloseFrameLength=false;this.parseState=r;this.closeStatus=-1}u.prototype.addData=function(e){if(this.parseState===r){if(e.length>=2){e.joinInto(this.frameHeader,0,0,2);e.advance(2);var t=this.frameHeader[0];var i=this.frameHeader[1];this.fin=Boolean(t&128);this.rsv1=Boolean(t&64);this.rsv2=Boolean(t&32);this.rsv3=Boolean(t&16);this.mask=Boolean(i&128);this.opcode=t&15;this.length=i&127;if(this.opcode>=8){if(this.length>125){this.protocolError=true;this.dropReason="Illegal control frame longer than 125 bytes.";return true}if(!this.fin){this.protocolError=true;this.dropReason="Control frames must not be fragmented.";return true}}if(this.length===126){this.parseState=n}else if(this.length===127){this.parseState=o}else{this.parseState=a}}}if(this.parseState===n){if(e.length>=2){e.joinInto(this.frameHeader,2,0,2);e.advance(2);this.length=this.frameHeader.readUInt16BE(2);this.parseState=a}}else if(this.parseState===o){if(e.length>=8){e.joinInto(this.frameHeader,2,0,8);e.advance(8);var u=[this.frameHeader.readUInt32BE(2),this.frameHeader.readUInt32BE(2+4)];if(u[0]!==0){this.protocolError=true;this.dropReason="Unsupported 64-bit length frame received";return true}this.length=u[1];this.parseState=a}}if(this.parseState===a){if(this.mask){if(e.length>=4){e.joinInto(this.maskBytes,0,0,4);e.advance(4);this.parseState=c}}else{this.parseState=c}}if(this.parseState===c){if(this.length>this.maxReceivedFrameSize){this.frameTooLarge=true;this.dropReason="Frame size of "+this.length.toString(10)+" bytes exceeds maximum accepted frame size";return true}if(this.length===0){this.binaryPayload=new Buffer(0);this.parseState=h;return true}if(e.length>=this.length){this.binaryPayload=e.take(this.length);e.advance(this.length);if(this.mask){s.unmask(this.binaryPayload,this.maskBytes)}if(this.opcode===8){if(this.length===1){this.binaryPayload=new Buffer(0);this.invalidCloseFrameLength=true}if(this.length>=2){this.closeStatus=this.binaryPayload.readUInt16BE(0);this.binaryPayload=this.binaryPayload.slice(2)}}this.parseState=h;return true}}return false};u.prototype.throwAwayPayload=function(e){if(e.length>=this.length){e.advance(this.length);this.parseState=h;return true}return false};u.prototype.toBuffer=function(e){var t;var i=2;var r;var n;var o=0;var a=0;if(this.fin){o|=128}if(this.rsv1){o|=64}if(this.rsv2){o|=32}if(this.rsv3){o|=16}if(this.mask){a|=128}o|=this.opcode&15;if(this.opcode===8){this.length=2;if(this.binaryPayload){this.length+=this.binaryPayload.length}r=new Buffer(this.length);r.writeUInt16BE(this.closeStatus,0);if(this.length>2){this.binaryPayload.copy(r,2)}}else if(this.binaryPayload){r=this.binaryPayload;this.length=r.length}else{this.length=0}if(this.length<=125){a|=this.length&127}else if(this.length>125&&this.length<=65535){a|=126;i+=2}else if(this.length>65535){a|=127;i+=8}var c=new Buffer(this.length+i+(this.mask?4:0));c[0]=o;c[1]=a;n=2;if(this.length>125&&this.length<=65535){c.writeUInt16BE(this.length,n);n+=2}else if(this.length>65535){c.writeUInt32BE(0,n);c.writeUInt32BE(this.length,n+4);n+=8}if(this.mask){t=e?0:Math.random()*4294967295>>>0;this.maskBytes.writeUInt32BE(t,0);this.maskBytes.copy(c,n);n+=4;if(r){s.mask(r,this.maskBytes,c,n,this.length)}}else if(r){r.copy(c,n)}return c};u.prototype.toString=function(){return"Opcode: "+this.opcode+", fin: "+this.fin+", length: "+this.length+", hasPayload: "+Boolean(this.binaryPayload)+", masked: "+this.mask};e.exports=u},function(e,t){e.exports=require("url")},function(e,t,i){var s=i(3);var r=i(0);var n=i(8);var o=i(1).EventEmitter;var a=i(4);var c=/,\s*/;var h=/;\s*/;var u=/[\r\n]/g;var l=/,\s*/;var f=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," ",String.fromCharCode(9)];var d=[String.fromCharCode(127)];for(var p=0;p<31;p++){d.push(String.fromCharCode(p))}var g=/([\x00-\x20\x22\x28\x29\x2c\x2f\x3a-\x3f\x40\x5b-\x5e\x7b\x7d\x7f])/;var m=/[^\x21\x23-\x2b\x2d-\x3a\x3c-\x5b\x5d-\x7e]/;var v=/^"[^"]*"$/;var b=/[\x00-\x20\x3b]/g;var y=/[;,] */;var E={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",406:"Not Acceptable",407:"Proxy Authorization Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Long",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};function S(e,t,i){o.call(this);this.socket=e;this.httpRequest=t;this.resource=t.url;this.remoteAddress=e.remoteAddress;this.remoteAddresses=[this.remoteAddress];this.serverConfig=i;this._socketIsClosing=false;this._socketCloseHandler=this._handleSocketCloseBeforeAccept.bind(this);this.socket.on("end",this._socketCloseHandler);this.socket.on("close",this._socketCloseHandler);this._resolved=false}r.inherits(S,o);S.prototype.readHandshake=function(){var e=this;var t=this.httpRequest;this.resourceURL=n.parse(this.resource,true);this.host=t.headers["host"];if(!this.host){throw new Error("Client must provide a Host header.")}this.key=t.headers["sec-websocket-key"];if(!this.key){throw new Error("Client must provide a value for Sec-WebSocket-Key.")}this.webSocketVersion=parseInt(t.headers["sec-websocket-version"],10);if(!this.webSocketVersion||isNaN(this.webSocketVersion)){throw new Error("Client must provide a value for Sec-WebSocket-Version.")}switch(this.webSocketVersion){case 8:case 13:break;default:var i=new Error("Unsupported websocket client version: "+this.webSocketVersion+"Only versions 8 and 13 are supported.");i.httpCode=426;i.headers={"Sec-WebSocket-Version":"13"};throw i}if(this.webSocketVersion===13){this.origin=t.headers["origin"]}else if(this.webSocketVersion===8){this.origin=t.headers["sec-websocket-origin"]}var s=t.headers["sec-websocket-protocol"];this.protocolFullCaseMap={};this.requestedProtocols=[];if(s){var r=s.split(c);r.forEach(function(t){var i=t.toLocaleLowerCase();e.requestedProtocols.push(i);e.protocolFullCaseMap[i]=t})}if(!this.serverConfig.ignoreXForwardedFor&&t.headers["x-forwarded-for"]){var o=this.remoteAddress;this.remoteAddresses=t.headers["x-forwarded-for"].split(l);this.remoteAddresses.push(o);this.remoteAddress=this.remoteAddresses[0]}var a=t.headers["sec-websocket-extensions"];this.requestedExtensions=this.parseExtensions(a);var h=t.headers["cookie"];this.cookies=this.parseCookies(h)};S.prototype.parseExtensions=function(e){if(!e||e.length===0){return[]}var t=e.toLocaleLowerCase().split(c);t.forEach(function(e,t,i){var s=e.split(h);var r=s[0];var n=s.slice(1);n.forEach(function(e,t,i){var s=e.split("=");var r={name:s[0],value:s[1]};i.splice(t,1,r)});var o={name:r,params:n};i.splice(t,1,o)});return t};S.prototype.parseCookies=function(e){if(!e||typeof e!=="string"){return[]}var t=[];var i=e.split(y);i.forEach(function(e){var i=e.indexOf("=");if(i===-1){t.push({name:e,value:null});return}var s=e.substr(0,i).trim();var r=e.substr(++i,e.length).trim();if('"'===r[0]){r=r.slice(1,-1)}t.push({name:s,value:decodeURIComponent(r)})});return t};S.prototype.accept=function(e,t,i){this._verifyResolution();var r;if(e){r=this.protocolFullCaseMap[e.toLocaleLowerCase()];if(typeof r==="undefined"){r=e}}else{r=e}this.protocolFullCaseMap=null;var n=s.createHash("sha1");n.update(this.key+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var o=n.digest("base64");var c="HTTP/1.1 101 Switching Protocols\r\n"+"Upgrade: websocket\r\n"+"Connection: Upgrade\r\n"+"Sec-WebSocket-Accept: "+o+"\r\n";if(r){for(var h=0;h<r.length;h++){var l=r.charCodeAt(h);var d=r.charAt(h);if(l<33||l>126||f.indexOf(d)!==-1){this.reject(500);throw new Error('Illegal character "'+String.fromCharCode(d)+'" in subprotocol.')}}if(this.requestedProtocols.indexOf(e)===-1){this.reject(500);throw new Error("Specified protocol was not requested by the client.")}r=r.replace(u,"");c+="Sec-WebSocket-Protocol: "+r+"\r\n"}this.requestedProtocols=null;if(t){t=t.replace(u,"");if(this.webSocketVersion===13){c+="Origin: "+t+"\r\n"}else if(this.webSocketVersion===8){c+="Sec-WebSocket-Origin: "+t+"\r\n"}}if(i){if(!Array.isArray(i)){this.reject(500);throw new Error('Value supplied for "cookies" argument must be an array.')}var p={};i.forEach(function(e){if(!e.name||!e.value){this.reject(500);throw new Error('Each cookie to set must at least provide a "name" and "value"')}e.name=e.name.replace(b,"");e.value=e.value.replace(b,"");if(p[e.name]){this.reject(500);throw new Error("You may not specify the same cookie name twice.")}p[e.name]=true;var t=e.name.match(g);if(t){this.reject(500);throw new Error("Illegal character "+t[0]+" in cookie name")}if(e.value.match(v)){t=e.value.slice(1,-1).match(m)}else{t=e.value.match(m)}if(t){this.reject(500);throw new Error("Illegal character "+t[0]+" in cookie value")}var i=[e.name+"="+e.value];if(e.path){t=e.path.match(b);if(t){this.reject(500);throw new Error("Illegal character "+t[0]+" in cookie path")}i.push("Path="+e.path)}if(e.domain){if(typeof e.domain!=="string"){this.reject(500);throw new Error("Domain must be specified and must be a string.")}t=e.domain.match(b);if(t){this.reject(500);throw new Error("Illegal character "+t[0]+" in cookie domain")}i.push("Domain="+e.domain.toLowerCase())}if(e.expires){if(!(e.expires instanceof Date)){this.reject(500);throw new Error('Value supplied for cookie "expires" must be a vaild date object')}i.push("Expires="+e.expires.toGMTString())}if(e.maxage){var s=e.maxage;if(typeof s==="string"){s=parseInt(s,10)}if(isNaN(s)||s<=0){this.reject(500);throw new Error('Value supplied for cookie "maxage" must be a non-zero number')}s=Math.round(s);i.push("Max-Age="+s.toString(10))}if(e.secure){if(typeof e.secure!=="boolean"){this.reject(500);throw new Error('Value supplied for cookie "secure" must be of type boolean')}i.push("Secure")}if(e.httponly){if(typeof e.httponly!=="boolean"){this.reject(500);throw new Error('Value supplied for cookie "httponly" must be of type boolean')}i.push("HttpOnly")}c+="Set-Cookie: "+i.join(";")+"\r\n"}.bind(this))}this._resolved=true;this.emit("requestResolved",this);c+="\r\n";var y=new a(this.socket,[],e,false,this.serverConfig);y.webSocketVersion=this.webSocketVersion;y.remoteAddress=this.remoteAddress;y.remoteAddresses=this.remoteAddresses;var E=this;if(this._socketIsClosing){_(y)}else{this.socket.write(c,"ascii",function(e){if(e){_(y);return}E._removeSocketCloseListeners();y._addSocketEventListeners()})}this.emit("requestAccepted",y);return y};S.prototype.reject=function(e,t,i){this._verifyResolution();this._resolved=true;this.emit("requestResolved",this);if(typeof e!=="number"){e=403}var s="HTTP/1.1 "+e+" "+E[e]+"\r\n"+"Connection: close\r\n";if(t){t=t.replace(u,"");s+="X-WebSocket-Reject-Reason: "+t+"\r\n"}if(i){for(var r in i){var n=i[r].toString().replace(u,"");var o=r.replace(u,"");s+=o+": "+n+"\r\n"}}s+="\r\n";this.socket.end(s,"ascii");this.emit("requestRejected",this)};S.prototype._handleSocketCloseBeforeAccept=function(){this._socketIsClosing=true;this._removeSocketCloseListeners()};S.prototype._removeSocketCloseListeners=function(){this.socket.removeListener("end",this._socketCloseHandler);this.socket.removeListener("close",this._socketCloseHandler)};S.prototype._verifyResolution=function(){if(this._resolved){throw new Error("WebSocketRequest may only be accepted or rejected one time.")}};function _(e){process.nextTick(function(){e.drop(1006,"TCP connection lost before handshake completed.",true)})}e.exports=S},function(e,t,i){t=e.exports=n.debug=n["default"]=n;t.coerce=h;t.disable=a;t.enable=o;t.enabled=c;t.humanize=i(36);t.names=[];t.skips=[];t.formatters={};var s;function r(e){var i=0,s;for(s in e){i=(i<<5)-i+e.charCodeAt(s);i|=0}return t.colors[Math.abs(i)%t.colors.length]}function n(e){function i(){if(!i.enabled)return;var e=i;var r=+new Date;var n=r-(s||r);e.diff=n;e.prev=s;e.curr=r;s=r;var o=new Array(arguments.length);for(var a=0;a<o.length;a++){o[a]=arguments[a]}o[0]=t.coerce(o[0]);if("string"!==typeof o[0]){o.unshift("%O")}var c=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(i,s){if(i==="%%")return i;c++;var r=t.formatters[s];if("function"===typeof r){var n=o[c];i=r.call(e,n);o.splice(c,1);c--}return i});t.formatArgs.call(e,o);var h=i.log||t.log||console.log.bind(console);h.apply(e,o)}i.namespace=e;i.enabled=t.enabled(e);i.useColors=t.useColors();i.color=r(e);if("function"===typeof t.init){t.init(i)}return i}function o(e){t.save(e);t.names=[];t.skips=[];var i=(typeof e==="string"?e:"").split(/[\s,]+/);var s=i.length;for(var r=0;r<s;r++){if(!i[r])continue;e=i[r].replace(/\*/g,".*?");if(e[0]==="-"){t.skips.push(new RegExp("^"+e.substr(1)+"$"))}else{t.names.push(new RegExp("^"+e+"$"))}}}function a(){t.enable("")}function c(e){var i,s;for(i=0,s=t.skips.length;i<s;i++){if(t.skips[i].test(e)){return false}}for(i=0,s=t.names.length;i<s;i++){if(t.names[i].test(e)){return true}}return false}function h(e){if(e instanceof Error)return e.stack||e.message;return e}},function(e,t,i){if(typeof process!=="undefined"&&process.type==="renderer"){e.exports=i(37)}else{e.exports=i(35)}},function(e,t,i){e.exports=i(39)},function(e,t,i){"use strict";i.r(t);const s={CONNECTION_CLOSED:"ACTION_CONNECTION_CLOSED",PING:"ACTION_PING",PONG:"ACTION_PONG",MOVE:"ACTION_MOVE",MESSAGE:"ACTION_MESSAGE",NOTICE:"ACTION_NOTICE",MUTE:"ACTION_MUTE",ERROR:"ACTION_ERROR",PEERS:"ACTION_PEERS",PEER_SET_NAME:"ACTION_PEER_SET_NAME",PEER_DISCONNECT:"ACTION_PEER_DISCONNECT",SET_NAME:"ACTION_SET_NAME"};class r{constructor(e,t){this.stamps=[];this.setRate(e,t)}setRate(e,t){this.rate=e;this.period=t;this.average=this.rate/this.period;this.ms=t*1e3}inLimit(){const e=new Date;for(var t=this.stamps.length-1,i=-1;t>i;--t){if(e-this.stamps[t]>this.ms){this.stamps.splice(0,t+1);break}}if(this.stamps.length<=this.rate){this.stamps.push(e);return true}else{return false}}getRate(){return this.average}}var n=i(3);class o{constructor(){this.tokens={}}register(e){this.tokens[e]=true}unregister(e){delete this.tokens[e]}exists(e){return this.tokens[e]!==undefined}getUnique(){const e=n["createHash"]("sha256");e.update(Math.random().toString());let t=e.digest("hex");while(this.exists(t)){e.update(Math.random().toString());t=e.digest("hex")}this.register(t);return t}}class a{constructor(e){this.clients=e;this.queue=[];this.broadcastRate=new r(8,1)}ping(e){this.clients[e].sendMessage(s.PING,{id:e,rate:this.clients[e].getRate(),peers:Object.keys(this.clients).map(e=>{return this.clients[e].getStateJSON()})})}message(e,t,i){this.clients[e].sendMessage(s.MESSAGE,{from:t,message:i})}notify(e,t){this.clients[e].sendMessage(s.NOTICE,{message:t})}broadcast(e,t){for(var i in this.clients){if(this.clients.hasOwnProperty(i)){this.clients[i].sendMessage(e,t)}}}broadcastMessage(e,t){this.broadcast(s.MESSAGE,{from:e,message:t})}broadcastNotice(e){this.broadcast(s.NOTICE,{message:e})}broadcastPlayerName(e,t){this.broadcastExclusive(s.PEER_SET_NAME,[{id:e,name:t}],e)}broadcastRemovePlayer(e){this.broadcast(s.PEER_DISCONNECT,{id:e})}broadcastExclusive(e,t,i){for(var s in this.clients){if(this.clients.hasOwnProperty(s)&&s!=i){this.clients[s].sendMessage(e,t)}}}broadcastPlayerStates(e){if(this.queue.indexOf(e)==-1){this.queue.push(e)}if(this.broadcastRate.inLimit()){this.broadcast(s.PEERS,this.queue.map(e=>{return this.clients[e].getStateJSON()}));this.queue=[]}}}class c{constructor(e,t,i){this.x=e;this.y=t;this.z=i}set(e){this.x=e.x;this.y=e.y;this.z=e.z}getJSON(){return{x:this.x,y:this.y,z:this.z}}}function h(e){return!(isNaN(e.x)||isNaN(e.y)||isNaN(e.z))}function u(e){return e.toString().replace(/[^a-zA-Z0-9 .,?'"!@#$%^&*()_\-+=]/gi,"")}function l(e,t){return e.length>0&&e.length<t}class f{constructor(e,t,i){this.onAction=i;this.id=t;this.name="User_"+t.substr(0,10);this.position=new c(0,0,0);this.motion=new c(0,0,0);this.maxMessageSize=250;this.muted={state:false,time:-1,timeout:10};this.rate={request:new r(4,1),spam:new r(5,5)};this.nameLock=false;this.client=e;this.client.on("message",e=>{this.onMessage(e)});this.client.on("close",e=>{this.onAction(s.CONNECTION_CLOSED,this.id,null)})}sendMessage(e,t){this.client.sendUTF(JSON.stringify({type:e,data:t}))}onMessage(e){if(this.rate.request.inLimit()&&e.type==="utf8"){try{const t=JSON.parse(e.utf8Data);switch(t.type){case s.MOVE:{this.setPosition(t.data);break}case s.MESSAGE:{this.setChatMessage(t.data);break}case s.SET_NAME:{this.setName(t.data);break}case s.PONG:{console.log("PONG");if(t.data.name&&!this.nameLock){console.log(t.data.name);this.setName(t.data.name)}if(t.data.p&&t.data.v){console.log(t.data.p,t.data.v);this.setPosition(t.data)}break}default:{break}}}catch(e){this.sendMessage(s.ERROR,null)}}}setChatMessage(e){if(!this.isMuted()){if(this.rate.spam.inLimit()){const t=u(e);if(l(t,this.maxMessageSize)){const e={from:this.name,message:t};this.onAction(s.MESSAGE,this.id,e)}}else{this.onAction(s.MUTE,this.id,this.muted.timeout);this.mute()}}}setName(e){if(!this.nameLock){const t=u(e);if(l(t,this.maxMessageSize)){this.nameLock=true;this.name=t;this.onAction(s.SET_NAME,this.id,this.name)}}}setPosition(e){if(h(e.p)&&h(e.v)){this.position.set(e.p);this.motion.set(e.v);this.onAction(s.MOVE,this.id,null)}}getRate(){return this.rate.request.getRate()}getStateJSON(){return{id:this.id,name:this.name,p:this.position.getJSON(),v:this.motion.getJSON()}}mute(){this.muted.state=true;this.muted.time=(new Date).getTime()+this.muted.timeout*1e3;this.muted.timeout+=5}isMuted(){if(this.muted.state){this.muted.state=(new Date).getTime()<=this.muted.time}return this.muted.state}}class d{constructor(){this.token=new o;this.clients={};this.packet=new a(this.clients)}add(e){const t=this.token.getUnique();const i=(e,t,i)=>{this.onUserAction(e,t,i)};this.clients[t]=new f(e,t,i);this.packet.ping(t)}remove(e){delete this.clients[e];this.token.unregister(e);this.packet.broadcastRemovePlayer(e);console.log("Disconnected",e)}onUserAction(e,t,i){if(e!=s.MOVE){console.log(e,i)}switch(e){case s.MOVE:{this.packet.broadcastPlayerStates(t);break}case s.MESSAGE:{this.packet.broadcastMessage(i.from,i.message);break}case s.MUTE:{this.packet.notify(t,`Don't spam. Muted ${i} seconds.`);break}case s.SET_NAME:{this.packet.notify(t,`Welcome ${i}!`);this.packet.broadcastPlayerName(t,i);break}case s.CONNECTION_CLOSED:{this.remove(t);break}default:{break}}}}var p=i(5);var g=i(12);class m{constructor(){this.port=1337;this.manager=new d;this.server=p["createServer"]((e,t)=>{});this.server.listen(this.port,()=>{console.log(new Date,`Listening on port: ${this.port}`)});this.ws=new g["server"]({httpServer:this.server,autoAcceptConnections:false});this.ws.on("request",e=>{if(this.verify(e)){this.manager.add(e.accept(null,e.origin))}else{e.reject()}})}verify(e){console.log("User connected",e.origin,e.remoteAddress);return true}}var v=new m},function(e){e.exports={_from:"websocket",_id:"websocket@1.0.26",_inBundle:false,_integrity:"sha512-fjcrYDPIQxpTnqFQ9JjxUQcdvR89MFAOjPBlF+vjOt49w/XW4fJknUoMz/mDIn2eK1AdslVojcaOxOqyZZV8rw==",_location:"/websocket",_phantomChildren:{},_requested:{type:"tag",registry:true,raw:"websocket",name:"websocket",escapedName:"websocket",rawSpec:"",saveSpec:null,fetchSpec:"latest"},_requiredBy:["#USER","/"],_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.26.tgz",_shasum:"a03a01299849c35268c83044aa919c6374be8194",_spec:"websocket",_where:"X:\\xampp\\htdocs\\github\\mmommo",author:{name:"Brian McKelvey",email:"brian@worlize.com",url:"https://www.worlize.com/"},browser:"lib/browser.js",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},bundleDependencies:false,config:{verbose:false},contributors:[{name:"IÃ±aki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],dependencies:{debug:"^2.2.0",nan:"^2.3.3","typedarray-to-buffer":"^3.1.2",yaeti:"^0.0.6"},deprecated:false,description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",devDependencies:{"buffer-equal":"^1.0.0",faucet:"^0.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-jshint":"^2.0.4",jshint:"^2.0.0","jshint-stylish":"^2.2.1",tape:"^4.0.1"},directories:{lib:"./lib"},engines:{node:">=0.10.0"},homepage:"https://github.com/theturtle32/WebSocket-Node",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],license:"Apache-2.0",main:"index",name:"websocket",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},scripts:{gulp:"gulp",install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit"},version:"1.0.26"}},function(e,t,i){e.exports=i(14).version},function(e,t){var i={disableWarnings:false,deprecationWarningMap:{},warn:function(e){if(!this.disableWarnings&&this.deprecationWarningMap[e]){console.warn("DEPRECATION WARNING: "+this.deprecationWarningMap[e]);this.deprecationWarningMap[e]=false}}};e.exports=i},function(e,t){e.exports=i;function i(e){this.type=e;this.isTrusted=false;this._yaeti=true}},function(e,t){e.exports=i;function i(){if(typeof this.addEventListener==="function"){return}this._listeners={};this.addEventListener=s;this.removeEventListener=r;this.dispatchEvent=n}Object.defineProperties(i.prototype,{listeners:{get:function(){return this._listeners}}});function s(e,t){var i,s,r;if(!e||!t){return}i=this._listeners[e];if(i===undefined){this._listeners[e]=i=[]}for(s=0;!!(r=i[s]);s++){if(r===t){return}}i.push(t)}function r(e,t){var i,s,r;if(!e||!t){return}i=this._listeners[e];if(i===undefined){return}for(s=0;!!(r=i[s]);s++){if(r===t){i.splice(s,1);break}}if(i.length===0){delete this._listeners[e]}}function n(e){var t,i,s,r=false,n,o;if(!e||typeof e.type!=="string"){throw new Error("`event` must have a valid `type` property")}if(e._yaeti){e.target=this;e.cancelable=true}try{e.stopImmediatePropagation=function(){r=true}}catch(e){}t=e.type;i=this._listeners[t]||[];s=this["on"+t];if(typeof s==="function"){s.call(this,e)}for(n=0;!!(o=i[n]);n++){if(r){break}o.call(this,e)}return!e.defaultPrevented}},function(e,t,i){e.exports={EventTarget:i(18),Event:i(17)}},function(e,t){e.exports=r;r.strict=n;r.loose=o;var i=Object.prototype.toString;var s={"[object Int8Array]":true,"[object Int16Array]":true,"[object Int32Array]":true,"[object Uint8Array]":true,"[object Uint8ClampedArray]":true,"[object Uint16Array]":true,"[object Uint32Array]":true,"[object Float32Array]":true,"[object Float64Array]":true};function r(e){return n(e)||o(e)}function n(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function o(e){return s[i.call(e)]}},function(e,t,i){var s=i(20).strict;e.exports=function e(t){if(s(t)){var i=Buffer.from(t.buffer);if(t.byteLength!==t.buffer.byteLength){i=i.slice(t.byteOffset,t.byteOffset+t.byteLength)}return i}else{return Buffer.from(t)}}},function(e,t,i){var s=i(6);var r=i(21);var n=i(19);const o=0;const a=1;const c=2;const h=3;e.exports=u;function u(e,t,i,r,a,c){n.EventTarget.call(this);c=c||{};c.assembleFragments=true;var h=this;this._url=e;this._readyState=o;this._protocol=undefined;this._extensions="";this._bufferedAmount=0;this._binaryType="arraybuffer";this._connection=undefined;this._client=new s(c);this._client.on("connect",function(e){d.call(h,e)});this._client.on("connectFailed",function(){p.call(h)});this._client.connect(e,t,i,r,a)}Object.defineProperties(u.prototype,{url:{get:function(){return this._url}},readyState:{get:function(){return this._readyState}},protocol:{get:function(){return this._protocol}},extensions:{get:function(){return this._extensions}},bufferedAmount:{get:function(){return this._bufferedAmount}}});Object.defineProperties(u.prototype,{binaryType:{get:function(){return this._binaryType},set:function(e){if(e!=="arraybuffer"){throw new SyntaxError('just "arraybuffer" type allowed for "binaryType" attribute')}this._binaryType=e}}});[["CONNECTING",o],["OPEN",a],["CLOSING",c],["CLOSED",h]].forEach(function(e){Object.defineProperty(u.prototype,e[0],{get:function(){return e[1]}})});[["CONNECTING",o],["OPEN",a],["CLOSING",c],["CLOSED",h]].forEach(function(e){Object.defineProperty(u,e[0],{get:function(){return e[1]}})});u.prototype.send=function(e){if(this._readyState!==a){throw new Error("cannot call send() while not connected")}if(typeof e==="string"||e instanceof String){this._connection.sendUTF(e)}else{if(e instanceof Buffer){this._connection.sendBytes(e)}else if(e.byteLength||e.byteLength===0){e=r(e);this._connection.sendBytes(e)}else{throw new Error("unknown binary data:",e)}}};u.prototype.close=function(e,t){switch(this._readyState){case o:p.call(this);this._client.on("connect",function(i){if(e){i.close(e,t)}else{i.close()}});break;case a:this._readyState=c;if(e){this._connection.close(e,t)}else{this._connection.close()}break;case c:case h:break}};function l(e,t){var i=new n.Event("close");i.code=e;i.reason=t;i.wasClean=typeof e==="undefined"||e===1e3;return i}function f(e){var t=new n.Event("message");t.data=e;return t}function d(e){var t=this;this._readyState=a;this._connection=e;this._protocol=e.protocol;this._extensions=e.extensions;this._connection.on("close",function(e,i){g.call(t,e,i)});this._connection.on("message",function(e){m.call(t,e)});this.dispatchEvent(new n.Event("open"))}function p(){v.call(this);this._readyState=h;try{this.dispatchEvent(new n.Event("error"))}finally{this.dispatchEvent(l(1006,"connection failed"))}}function g(e,t){v.call(this);this._readyState=h;this.dispatchEvent(l(e,t||""))}function m(e){if(e.utf8Data){this.dispatchEvent(f(e.utf8Data))}else if(e.binaryData){if(this.binaryType==="arraybuffer"){var t=e.binaryData;var i=new ArrayBuffer(t.length);var s=new Uint8Array(i);for(var r=0,n=t.length;r<n;++r){s[r]=t[r]}this.dispatchEvent(f(i))}}}function v(){this._client.removeAllListeners();if(this._connection){this._connection.removeAllListeners()}}},function(e,t,i){var s=i(0);var r=i(1).EventEmitter;function n(e,t){r.call(this);this.webSocketRequest=e;if(t==="____no_protocol____"){this.protocol=null}else{this.protocol=t}this.origin=e.origin;this.resource=e.resource;this.resourceURL=e.resourceURL;this.httpRequest=e.httpRequest;this.remoteAddress=e.remoteAddress;this.webSocketVersion=e.webSocketVersion;this.requestedExtensions=e.requestedExtensions;this.cookies=e.cookies}s.inherits(n,r);n.prototype.accept=function(e,t){var i=this.webSocketRequest.accept(this.protocol,e,t);this.emit("requestAccepted",i);return i};n.prototype.reject=function(e,t,i){this.webSocketRequest.reject(e,t,i);this.emit("requestRejected",this)};e.exports=n},function(e,t,i){var s=i(2).extend;var r=i(0);var n=i(1).EventEmitter;var o=i(23);function a(e){n.call(this);this.config={server:null};if(e){s(this.config,e)}this.handlers=[];this._requestHandler=this.handleRequest.bind(this);if(this.config.server){this.attachServer(this.config.server)}}r.inherits(a,n);a.prototype.attachServer=function(e){if(e){this.server=e;this.server.on("request",this._requestHandler)}else{throw new Error("You must specify a WebSocketServer instance to attach to.")}};a.prototype.detachServer=function(){if(this.server){this.server.removeListener("request",this._requestHandler);this.server=null}else{throw new Error("Cannot detach from server: not attached.")}};a.prototype.mount=function(e,t,i){if(!e){throw new Error("You must specify a path for this handler.")}if(!t){t="____no_protocol____"}if(!i){throw new Error("You must specify a callback for this handler.")}e=this.pathToRegExp(e);if(!(e instanceof RegExp)){throw new Error("Path must be specified as either a string or a RegExp.")}var s=e.toString();t=t.toLocaleLowerCase();if(this.findHandlerIndex(s,t)!==-1){throw new Error("You may only mount one handler per path/protocol combination.")}this.handlers.push({path:e,pathString:s,protocol:t,callback:i})};a.prototype.unmount=function(e,t){var i=this.findHandlerIndex(this.pathToRegExp(e).toString(),t);if(i!==-1){this.handlers.splice(i,1)}else{throw new Error("Unable to find a route matching the specified path and protocol.")}};a.prototype.findHandlerIndex=function(e,t){t=t.toLocaleLowerCase();for(var i=0,s=this.handlers.length;i<s;i++){var r=this.handlers[i];if(r.pathString===e&&r.protocol===t){return i}}return-1};a.prototype.pathToRegExp=function(e){if(typeof e==="string"){if(e==="*"){e=/^.*$/}else{e=e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");e=new RegExp("^"+e+"$")}}return e};a.prototype.handleRequest=function(e){var t=e.requestedProtocols;if(t.length===0){t=["____no_protocol____"]}for(var i=0;i<t.length;i++){var s=t[i].toLocaleLowerCase();for(var r=0,n=this.handlers.length;r<n;r++){var a=this.handlers[r];if(a.path.test(e.resourceURL.pathname)){if(s===a.protocol||a.protocol==="*"){var c=new o(e,s);a.callback(c);return}}}}e.reject(404,"No handler is available for the given request.")};e.exports=a},function(e,t){e.exports=require("https")},function(e,t){
/*!
 * UTF-8 Validation Fallback Code originally from:
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
e.exports.Validation={isValidUTF8:function(){return true}}},function(e,t,i){
/*!
 * UTF-8 Validation Code originally from:
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
try{e.exports=i(!function e(){var t=new Error('Cannot find module "../build/Release/validation"');t.code="MODULE_NOT_FOUND";throw t}())}catch(t){try{e.exports=i(!function e(){var t=new Error('Cannot find module "../build/default/validation"');t.code="MODULE_NOT_FOUND";throw t}())}catch(t){try{e.exports=i(26)}catch(e){console.error("validation.node seems not to have been built. Run npm install.");throw e}}}},function(e,t){e.exports=require("buffer")},function(e,t,i){var s=i(28).Buffer;var r=i(1).EventEmitter;e.exports=n;e.exports.BufferList=n;function n(e){if(!(this instanceof n))return new n(e);r.call(this);var t=this;if(typeof e=="undefined")e={};t.encoding=e.encoding;t.construct=e.construct||s;var i={next:null,buffer:null};var o={next:null,buffer:null};var a=0;t.__defineGetter__("length",function(){return a});var c=0;t.write=function(e){if(!i.buffer){i.buffer=e;o=i}else{o.next={next:null,buffer:e};o=o.next}a+=e.length;t.emit("write",e);return true};t.end=function(e){if(s.isBuffer(e))t.write(e)};t.push=function(){var e=[].concat.apply([],arguments);e.forEach(t.write);return t};t.forEach=function(e){if(!i.buffer)return new t.construct(0);if(i.buffer.length-c<=0)return t;var s=i.buffer.slice(c);var r={buffer:s,next:i.next};while(r&&r.buffer){var n=e(r.buffer);if(n)break;r=r.next}return t};t.join=function(e,s){if(!i.buffer)return new t.construct(0);if(e==undefined)e=0;if(s==undefined)s=t.length;var r=new t.construct(s-e);var n=0;t.forEach(function(t){if(e<n+t.length&&n<s){t.copy(r,Math.max(0,n-e),Math.max(0,e-n),Math.min(t.length,s-n))}n+=t.length;if(n>s)return true});return r};t.joinInto=function(e,s,r,n){if(!i.buffer)return new t.construct(0);if(r==undefined)r=0;if(n==undefined)n=t.length;var o=e;if(o.length-s<n-r){throw new Error("Insufficient space available in target Buffer.")}var a=0;t.forEach(function(e){if(r<a+e.length&&a<n){e.copy(o,Math.max(s,s+a-r),Math.max(0,r-a),Math.min(e.length,n-a))}a+=e.length;if(a>n)return true});return o};t.advance=function(e){c+=e;a-=e;while(i.buffer&&c>=i.buffer.length){c-=i.buffer.length;i=i.next?i.next:{buffer:null,next:null}}if(i.buffer===null)o={next:null,buffer:null};t.emit("advance",e);return t};t.take=function(e,s){if(e==undefined)e=t.length;else if(typeof e!=="number"){s=e;e=t.length}var r=i;if(!s)s=t.encoding;if(s){var n="";t.forEach(function(t){if(e<=0)return true;n+=t.toString(s,0,Math.min(e,t.length));e-=t.length});return n}else{return t.join(0,e)}};t.toString=function(){return t.take("binary")}}i(0).inherits(n,r)},function(e,t){
/*!
 * Copied from:
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
e.exports.BufferUtil={merge:function(e,t){var i=0;for(var s=0,r=t.length;s<r;++s){var n=t[s];n.copy(e,i);i+=n.length}},mask:function(e,t,i,s,r){var n=t.readUInt32LE(0);var o=0;for(;o<r-3;o+=4){var a=n^e.readUInt32LE(o);if(a<0){a=4294967296+a}i.writeUInt32LE(a,s+o)}switch(r%4){case 3:i[s+o+2]=e[o+2]^t[2];case 2:i[s+o+1]=e[o+1]^t[1];case 1:i[s+o]=e[o]^t[0];case 0:}},unmask:function(e,t){var i=t.readUInt32LE(0);var s=e.length;var r=0;for(;r<s-3;r+=4){var n=i^e.readUInt32LE(r);if(n<0){n=4294967296+n}e.writeUInt32LE(n,r)}switch(s%4){case 3:e[r+2]=e[r+2]^t[2];case 2:e[r+1]=e[r+1]^t[1];case 1:e[r]=e[r]^t[0];case 0:}}}},function(e,t,i){
/*!
 * Copied from:
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
try{e.exports=i(!function e(){var t=new Error('Cannot find module "../build/Release/bufferutil"');t.code="MODULE_NOT_FOUND";throw t}())}catch(t){try{e.exports=i(!function e(){var t=new Error('Cannot find module "../build/default/bufferutil"');t.code="MODULE_NOT_FOUND";throw t}())}catch(t){try{e.exports=i(30)}catch(e){console.error("bufferutil.node seems to not have been built. Run npm install.");throw e}}}},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("tty")},function(e,t,i){var s=i(34);var r=i(0);t=e.exports=i(10);t.init=d;t.log=h;t.formatArgs=c;t.save=u;t.load=l;t.useColors=a;t.colors=[6,2,3,4,5,1];t.inspectOpts=Object.keys(process.env).filter(function(e){return/^debug_/i.test(e)}).reduce(function(e,t){var i=t.substring(6).toLowerCase().replace(/_([a-z])/g,function(e,t){return t.toUpperCase()});var s=process.env[t];if(/^(yes|on|true|enabled)$/i.test(s))s=true;else if(/^(no|off|false|disabled)$/i.test(s))s=false;else if(s==="null")s=null;else s=Number(s);e[i]=s;return e},{});var n=parseInt(process.env.DEBUG_FD,10)||2;if(1!==n&&2!==n){r.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")()}var o=1===n?process.stdout:2===n?process.stderr:f(n);function a(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):s.isatty(n)}t.formatters.o=function(e){this.inspectOpts.colors=this.useColors;return r.inspect(e,this.inspectOpts).split("\n").map(function(e){return e.trim()}).join(" ")};t.formatters.O=function(e){this.inspectOpts.colors=this.useColors;return r.inspect(e,this.inspectOpts)};function c(e){var i=this.namespace;var s=this.useColors;if(s){var r=this.color;var n="  [3"+r+";1m"+i+" "+"[0m";e[0]=n+e[0].split("\n").join("\n"+n);e.push("[3"+r+"m+"+t.humanize(this.diff)+"[0m")}else{e[0]=(new Date).toUTCString()+" "+i+" "+e[0]}}function h(){return o.write(r.format.apply(r,arguments)+"\n")}function u(e){if(null==e){delete process.env.DEBUG}else{process.env.DEBUG=e}}function l(){return process.env.DEBUG}function f(e){var t;var r=process.binding("tty_wrap");switch(r.guessHandleType(e)){case"TTY":t=new s.WriteStream(e);t._type="tty";if(t._handle&&t._handle.unref){t._handle.unref()}break;case"FILE":var n=i(33);t=new n.SyncWriteStream(e,{autoClose:false});t._type="fs";break;case"PIPE":case"TCP":var o=i(32);t=new o.Socket({fd:e,readable:false,writable:true});t.readable=false;t.read=null;t._type="pipe";if(t._handle&&t._handle.unref){t._handle.unref()}break;default:throw new Error("Implement me. Unknown stream file type!")}t.fd=e;t._isStdio=true;return t}function d(e){e.inspectOpts={};var i=Object.keys(t.inspectOpts);for(var s=0;s<i.length;s++){e.inspectOpts[i[s]]=t.inspectOpts[i[s]]}}t.enable(l())},function(e,t){var i=1e3;var s=i*60;var r=s*60;var n=r*24;var o=n*365.25;e.exports=function(e,t){t=t||{};var i=typeof e;if(i==="string"&&e.length>0){return a(e)}else if(i==="number"&&isNaN(e)===false){return t.long?h(e):c(e)}throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function a(e){e=String(e);if(e.length>100){return}var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t){return}var a=parseFloat(t[1]);var c=(t[2]||"ms").toLowerCase();switch(c){case"years":case"year":case"yrs":case"yr":case"y":return a*o;case"days":case"day":case"d":return a*n;case"hours":case"hour":case"hrs":case"hr":case"h":return a*r;case"minutes":case"minute":case"mins":case"min":case"m":return a*s;case"seconds":case"second":case"secs":case"sec":case"s":return a*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return undefined}}function c(e){if(e>=n){return Math.round(e/n)+"d"}if(e>=r){return Math.round(e/r)+"h"}if(e>=s){return Math.round(e/s)+"m"}if(e>=i){return Math.round(e/i)+"s"}return e+"ms"}function h(e){return u(e,n,"day")||u(e,r,"hour")||u(e,s,"minute")||u(e,i,"second")||e+" ms"}function u(e,t,i){if(e<t){return}if(e<t*1.5){return Math.floor(e/t)+" "+i}return Math.ceil(e/t)+" "+i+"s"}},function(e,t,i){t=e.exports=i(10);t.log=n;t.formatArgs=r;t.save=o;t.load=a;t.useColors=s;t.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:c();t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function s(){if(typeof window!=="undefined"&&window.process&&window.process.type==="renderer"){return true}return typeof document!=="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!=="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function r(e){var i=this.useColors;e[0]=(i?"%c":"")+this.namespace+(i?" %c":" ")+e[0]+(i?"%c ":" ")+"+"+t.humanize(this.diff);if(!i)return;var s="color: "+this.color;e.splice(1,0,s,"color: inherit");var r=0;var n=0;e[0].replace(/%[a-zA-Z%]/g,function(e){if("%%"===e)return;r++;if("%c"===e){n=r}});e.splice(n,0,s)}function n(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(e){try{if(null==e){t.storage.removeItem("debug")}else{t.storage.debug=e}}catch(e){}}function a(){var e;try{e=t.storage.debug}catch(e){}if(!e&&typeof process!=="undefined"&&"env"in process){e=process.env.DEBUG}return e}t.enable(a());function c(){try{return window.localStorage}catch(e){}}},function(e,t,i){var s=i(2).extend;var r=i(2);var n=i(0);var o=i(11)("websocket:server");var a=i(1).EventEmitter;var c=i(9);var h=function e(t){a.call(this);this._handlers={upgrade:this.handleUpgrade.bind(this),requestAccepted:this.handleRequestAccepted.bind(this),requestResolved:this.handleRequestResolved.bind(this)};this.connections=[];this.pendingRequests=[];if(t){this.mount(t)}};n.inherits(h,a);h.prototype.mount=function(e){this.config={httpServer:null,maxReceivedFrameSize:65536,maxReceivedMessageSize:1048576,fragmentOutgoingMessages:true,fragmentationThreshold:16384,keepalive:true,keepaliveInterval:2e4,dropConnectionOnKeepaliveTimeout:true,keepaliveGracePeriod:1e4,useNativeKeepalive:false,assembleFragments:true,autoAcceptConnections:false,ignoreXForwardedFor:false,disableNagleAlgorithm:true,closeTimeout:5e3};s(this.config,e);if(this.config.httpServer){if(!Array.isArray(this.config.httpServer)){this.config.httpServer=[this.config.httpServer]}var t=this._handlers.upgrade;this.config.httpServer.forEach(function(e){e.on("upgrade",t)})}else{throw new Error("You must specify an httpServer on which to mount the WebSocket server.")}};h.prototype.unmount=function(){var e=this._handlers.upgrade;this.config.httpServer.forEach(function(t){t.removeListener("upgrade",e)})};h.prototype.closeAllConnections=function(){this.connections.forEach(function(e){e.close()});this.pendingRequests.forEach(function(e){process.nextTick(function(){e.reject(503)})})};h.prototype.broadcast=function(e){if(Buffer.isBuffer(e)){this.broadcastBytes(e)}else if(typeof e.toString==="function"){this.broadcastUTF(e)}};h.prototype.broadcastUTF=function(e){this.connections.forEach(function(t){t.sendUTF(e)})};h.prototype.broadcastBytes=function(e){this.connections.forEach(function(t){t.sendBytes(e)})};h.prototype.shutDown=function(){this.unmount();this.closeAllConnections()};h.prototype.handleUpgrade=function(e,t){var i=new c(t,e,this.config);try{i.readHandshake()}catch(e){i.reject(e.httpCode?e.httpCode:400,e.message,e.headers);o("Invalid handshake: %s",e.message);return}this.pendingRequests.push(i);i.once("requestAccepted",this._handlers.requestAccepted);i.once("requestResolved",this._handlers.requestResolved);if(!this.config.autoAcceptConnections&&r.eventEmitterListenerCount(this,"request")>0){this.emit("request",i)}else if(this.config.autoAcceptConnections){i.accept(i.requestedProtocols[0],i.origin)}else{i.reject(404,"No handler is configured to accept the connection.")}};h.prototype.handleRequestAccepted=function(e){var t=this;e.once("close",function(i,s){t.handleConnectionClose(e,i,s)});this.connections.push(e);this.emit("connect",e)};h.prototype.handleConnectionClose=function(e,t,i){var s=this.connections.indexOf(e);if(s!==-1){this.connections.splice(s,1)}this.emit("close",e,t,i)};h.prototype.handleRequestResolved=function(e){var t=this.pendingRequests.indexOf(e);if(t!==-1){this.pendingRequests.splice(t,1)}};e.exports=h},function(e,t,i){e.exports={server:i(38),client:i(6),router:i(24),frame:i(7),request:i(9),connection:i(4),w3cwebsocket:i(22),deprecation:i(16),version:i(15)}}]);